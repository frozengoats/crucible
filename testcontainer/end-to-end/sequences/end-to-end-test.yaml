name: endToEndTest
description: test and verify all functionality of crucible
sequence:

  - description: list the contents of the current directory
    shell: ls -la

  - description: get the current working directory
    shell: pwd

  - description: get the current user
    shell: whoami

  - description: create a directory on the target machine
    shell: mkdir -p ~/drop-zone

  - description: verify the directory was created
    shell: ls -la ~/drop-zone

  - description: put some known text in the file
    shell: echo "hello world" > ~/drop-zone/hello.txt

  - name: hello
    description: pull known text from file
    shell: cat ~/drop-zone/hello.txt

  - when: "line(.Context.hello.stdout) == 'hello world'"
    description: place another file, confirming that the when clause worked
    shell: echo "when is good" > ~/drop-zone/when.txt

  - description: verify the when file
    shell: ls -la ~/drop-zone/when.txt

  - description: iterate the number set and make some output files
    iterate: .Values.things.numbers
    action:
      shell: echo {{ .item }} > ~/drop-zone/{{ .item }}.txt

  - description: list all dz contents
    shell: ls -la ~/drop-zone/*.txt

  - description: make sure one of those files exists and contains the right data
    # this should fail on exit code if the file does not exist
    shell: cat ~/drop-zone/3.txt
    # if the file exists, we will hit this evaluation and fail if the data is incorrect
    failWhen: line(.stdout) != "3"

  - description: iterate the number set and make some output files
    iterate: .Values.things.numbers
    action:
      shell: cat ~/drop-zone/{{ .item }}.txt
      failWhen: line(.stdout) != to_string(.item)

  # - description: cause the system to break with a bad request
  #   shell: ls -la ~/ddd


